#BEESHEET SCRAPE to XML

import requests
from bs4 import BeautifulSoup
import json
import os
import sys
from xml.etree import ElementTree as ET

def scrape_bee(url):
    r = requests.get(url, headers={'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/39.0.2171.95 Safari/537.36'})
    soup = BeautifulSoup(r.text, 'html.parser')
    
    element = soup.find('div', class_='pz-game-screen')
    element = element.find('script')
    
    data = element.contents[0].replace('window.gameData = ', '')
    data = json.loads(data)
    
    return data

def save_to_xml(data, filename):
    root = ET.Element('data')
    today = ET.SubElement(root, 'today')
    yesterday = ET.SubElement(root, 'yesterday')
    
    for day, day_data in data.items():
        if day == 'today':
            current_day = today
        elif day == 'yesterday':
            current_day = yesterday
        else:
            continue
        
        for key, value in day_data.items():
            if isinstance(value, list):
                sub_element = ET.SubElement(current_day, key)
                for item in value:
                    sub_sub_element = ET.SubElement(sub_element, 'item')
                    sub_sub_element.text = item
            else:
                sub_element = ET.SubElement(current_day, key)
                sub_element.text = str(value)
    
    tree = ET.ElementTree(root)
    tree.write(filename, encoding='utf-8', xml_declaration=True)

if __name__ == '__main__':
    url = 'https://www.nytimes.com/puzzles/spelling-bee'  # Change this URL if needed
    scraped_data = scrape_bee(url)
    save_to_xml(scraped_data, 'beesheet.xml')
